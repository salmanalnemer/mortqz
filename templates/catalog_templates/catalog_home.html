{% load static %}
<!-- catalog_home.html (Editorial / Magazine Style - VERY DIFFERENT) -->
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù†ÙŠØ© | Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>

  <style>
    :root{
      --ink:#0b1220;
      --muted:#5d6b7a;
      --line:#e6ebf2;

      --bg1:#f8fafc;
      --bg2:#ffffff;

      --card:#ffffff;
      --card2:#f3f6fb;

      --brand:#1f2a44;
      --brand2:#2c4ea8;
      --accent:#14b8a6; /* teal */

      --radius:20px;
      --shadow: 0 16px 40px rgba(11,18,32,.10);
      --shadow2: 0 10px 22px rgba(11,18,32,.08);
    }

    body{
      margin:0;
      color: var(--ink);
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      background:
        radial-gradient(1000px 600px at 15% -10%, rgba(20,184,166,.18), transparent 55%),
        radial-gradient(900px 520px at 95% 0%, rgba(44,78,168,.14), transparent 58%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    a{ color: inherit; text-decoration: none; }
    .wrap{ max-width: 1200px; margin: 0 auto; padding: 0 16px; }
    main{ padding: 18px 0 44px; }

    /* ===== Page Header (small, independent from header.html) ===== */
    .page-head{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
      margin-top: 6px;
    }
    .page-head h1{
      margin:0;
      font-size: 18px;
      font-weight: 1000;
      letter-spacing:.2px;
    }
    .page-head p{
      margin:6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.8;
    }
    .head-actions{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap:wrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.80);
      box-shadow: 0 10px 18px rgba(11,18,32,.06);
      font-size: 13px;
      color: rgba(11,18,32,.90);
      white-space: nowrap;
    }
    .cta{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 11px 14px;
      border-radius: 14px;
      border: 1px solid rgba(44,78,168,.18);
      background: linear-gradient(135deg, rgba(44,78,168,.95), rgba(31,42,68,.95));
      color:#fff;
      font-weight: 1000;
      cursor:pointer;
      box-shadow: 0 14px 26px rgba(44,78,168,.18);
    }
    .cta:hover{ filter: brightness(1.03); }

    /* ===== Editorial Hero (SIMPLIFIED) ===== */
    .editorial{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1.5fr 1fr;
      gap: 12px;
      align-items: stretch;
    }

    .feature{
      border: 1px solid var(--line);
      border-radius: 22px;
      overflow:hidden;
      background: rgba(255,255,255,.92);
      box-shadow: var(--shadow);
      min-height: 240px;
      display:flex;
      flex-direction:column;
      justify-content:center;
    }

    .feature-content{
      padding: 18px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .kicker{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      width: fit-content;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--card2);
      border: 1px solid var(--line);
      font-size: 12px;
      font-weight: 1000;
      color: rgba(11,18,32,.88);
    }

    .feature h2{
      margin:0;
      font-size: 24px;
      line-height: 1.25;
      font-weight: 1000;
      letter-spacing:.2px;
      color: var(--ink);
      max-width: 28ch;
    }
    .feature p{
      margin:0;
      color: rgba(11,18,32,.78);
      line-height: 1.9;
      font-size: 14px;
      max-width: 62ch;
    }

    .feature-actions{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 6px;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 11px 13px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: #fff;
      color: rgba(11,18,32,.92);
      cursor:pointer;
      font-weight: 1000;
      box-shadow: 0 10px 18px rgba(11,18,32,.06);
      user-select:none;
    }
    .btn.primary{
      background: linear-gradient(135deg, rgba(44,78,168,.95), rgba(31,42,68,.95));
      color:#fff;
      border-color: rgba(44,78,168,.18);
      box-shadow: 0 14px 26px rgba(44,78,168,.18);
    }
    .btn:hover{ filter: brightness(1.03); }

    .sidecol{
      display:grid;
      grid-template-rows: 1fr 1fr;
      gap: 12px;
    }

    .mini-card{
      border: 1px solid var(--line);
      border-radius: 22px;
      background: rgba(255,255,255,.92);
      box-shadow: var(--shadow2);
      padding: 16px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .mini-card .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .mini-card .ico{
      width: 44px; height: 44px;
      border-radius: 16px;
      background: var(--card2);
      border: 1px solid var(--line);
      display:grid;
      place-items:center;
      font-size: 18px;
      color: rgba(11,18,32,.88);
      flex:0 0 auto;
    }
    .mini-card .t{
      font-weight: 1000;
      font-size: 14px;
      color: rgba(11,18,32,.95);
    }
    .mini-card .d{
      margin-top: 6px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.8;
    }
    .mini-card .foot{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--card2);
      border: 1px solid var(--line);
      font-size: 12px;
      font-weight: 1000;
      color: rgba(11,18,32,.85);
      white-space:nowrap;
    }
    .link{
      font-size: 13px;
      font-weight: 1000;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: #fff;
      cursor:pointer;
    }
    .link:hover{ background: var(--card2); }

    /* ===== Highlights strip ===== */
    .highlights{
      margin-top: 14px;
      border: 1px solid var(--line);
      border-radius: 22px;
      background: rgba(255,255,255,.85);
      box-shadow: 0 10px 18px rgba(11,18,32,.06);
      overflow:hidden;
    }
    .high-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(243,246,251,.95), rgba(255,255,255,.75));
    }
    .high-head .h{
      font-weight: 1000;
      font-size: 14px;
    }
    .high-head .s{
      color: var(--muted);
      font-size: 12px;
      margin-top: 4px;
    }

    .strip{
      display:flex;
      gap: 10px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding: 12px 12px 14px;
      scrollbar-width: thin;
    }
    .strip::-webkit-scrollbar{ height: 8px; }
    .strip::-webkit-scrollbar-thumb{ background: rgba(11,18,32,.14); border-radius: 999px; }

    .story{
      flex: 0 0 auto;
      width: 220px;
      border-radius: 18px;
      border: 1px solid var(--line);
      background: #fff;
      box-shadow: 0 10px 18px rgba(11,18,32,.06);
      padding: 12px;
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .story:hover{ transform: translateY(-2px); box-shadow: var(--shadow2); }
    .story .pic{
      height: 110px;
      border-radius: 14px;
      background:
        radial-gradient(circle at 25% 25%, rgba(20,184,166,.14), transparent 55%),
        linear-gradient(135deg, rgba(44,78,168,.16), rgba(243,246,251,.9));
      border: 1px solid var(--line);
      margin-bottom: 10px;
    }
    .story .t{
      font-weight: 1000;
      font-size: 13px;
      line-height: 1.35;
    }
    .story .d{
      margin-top: 6px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.7;
    }

    /* ===== Sections ===== */
    .section{ margin-top: 18px; }
    .section-head{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      margin-bottom: 12px;
    }
    .section-title{
      margin:0;
      font-size: 18px;
      font-weight: 1000;
      color: rgba(11,18,32,.95);
    }
    .section-sub{
      margin:0;
      color: var(--muted);
      font-size: 13px;
    }

    /* ===== Categories as Tiles (NOT pills) ===== */
    .tiles{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    .tile{
      border-radius: 22px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.92);
      box-shadow: 0 10px 18px rgba(11,18,32,.06);
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      transition: transform .15s ease, box-shadow .15s ease;
      position:relative;
      overflow:hidden;
      min-height: 120px;
    }
    .tile:hover{ transform: translateY(-2px); box-shadow: var(--shadow2); }
    .tile::after{
      content:"";
      position:absolute;
      inset:-60%;
      background: radial-gradient(circle at 30% 30%, rgba(20,184,166,.12), transparent 55%);
      transform: rotate(10deg);
      opacity:.7;
      pointer-events:none;
    }
    .tile .row{
      position:relative;
      display:flex; align-items:center; justify-content:space-between; gap: 10px;
    }
    .tile .ico{
      width: 48px; height: 48px;
      border-radius: 18px;
      background: rgba(243,246,251,.95);
      border: 1px solid var(--line);
      display:grid; place-items:center;
      font-size: 20px;
      color: rgba(11,18,32,.9);
    }
    .tile .name{
      position:relative;
      font-weight: 1000;
      font-size: 14px;
    }
    .tile .hint{
      position:relative;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.8;
      margin:0;
    }

    /* ===== Benefits ===== */
    .benefits{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    .benefit{
      border-radius: 22px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.92);
      padding: 16px;
      box-shadow: 0 10px 18px rgba(11,18,32,.06);
    }
    .benefit .t{ font-weight: 1000; margin: 8px 0 6px; }
    .benefit .d{ color: var(--muted); font-size: 13px; line-height: 1.8; margin:0; }

    @media (max-width: 980px){
      .editorial{ grid-template-columns: 1fr; }
      .sidecol{ grid-template-columns: 1fr 1fr; grid-template-rows: auto; }
      .tiles{ grid-template-columns: 1fr 1fr; }
      .benefits{ grid-template-columns: 1fr; }
    }
    @media (max-width: 520px){
      .sidecol{ grid-template-columns: 1fr; }
      .feature h2{ font-size: 22px; }
      .tiles{ grid-template-columns: 1fr; }
      .story{ width: 200px; }
    }
  </style>
</head>

<body>

  {% include 'header.html' %}

  <main class="wrap">

    <div class="page-head">
      <div>
        <h1>ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªØ¬Ø±</h1>
        <p>Ø¹Ø±Ø¶ Ø­Ø¯ÙŠØ« Ù…Ø®ØªÙ„Ù ØªÙ…Ø§Ù…Ù‹Ø§ â€” ÙˆØ§Ø¬Ù‡Ø© Ø£Ù‚Ø±Ø¨ Ù„ØªØµÙ…ÙŠÙ… â€œÙ…Ø¬Ù„Ù‘Ø©â€ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶.</p>
      </div>
      <div class="head-actions">
        <span class="pill">ğŸšš ØªÙˆØµÙŠÙ„ 24â€“48 Ø³Ø§Ø¹Ø©</span>
        <span class="pill">ğŸ” Ø¯ÙØ¹ Ø¢Ù…Ù†</span>
        <a class="cta" href="#featured">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚</a>
      </div>
    </div>

    <!-- EDITORIAL HERO (SIMPLIFIED) -->
    <section class="editorial" aria-label="Ù‚Ø³Ù… Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©">
      <article class="feature">
        <div class="feature-content">
          <span class="kicker">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span>
          <h2>ØªØ¬Ø±Ø¨Ø© ØªÙ‚Ù†ÙŠØ© Ø£Ø±Ù‚Ù‰â€¦ Ø¨ØªØµÙ…ÙŠÙ… Ø¨Ø³ÙŠØ·</h2>
          <p>
            ÙˆØ§Ø¬Ù‡Ø© ØªØ¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø£Ø³Ù„ÙˆØ¨ ÙˆØ§Ø¶Ø­: Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ø±ØªÙ‘Ø¨Ø©ØŒ ØªÙ†Ù‚Ù‘Ù„ Ø³Ø±ÙŠØ¹ØŒ
            ÙˆØ¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯ â€” Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ù…Ø§ ØªØ±ÙŠØ¯ Ø¨Ø³Ø±Ø¹Ø© ÙˆØ¨Ø´ÙƒÙ„ Ø¬Ù…ÙŠÙ„.
          </p>
          <div class="feature-actions">
            <a class="btn primary" href="#featured">Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
            <a class="btn" href="#categories">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</a>
            <a class="btn" href="#" data-action="track">ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ø·Ù„Ø¨</a>
          </div>
        </div>
      </article>

      <div class="sidecol">
        <div class="mini-card">
          <div class="top">
            <div>
              <div class="t">Ù…Ø²Ø§ÙŠØ§ Ø§Ù„Ø´Ø­Ù†</div>
              <div class="d">ØªØºÙ„ÙŠÙ Ø§Ø­ØªØ±Ø§ÙÙŠ + ØªØ­Ø¯ÙŠØ«Ø§Øª Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨.</div>
            </div>
            <div class="ico">ğŸ“¦</div>
          </div>
          <div class="foot">
            <span class="chip">Ø³Ø±ÙŠØ¹</span>
            <a class="link" href="#" data-action="support">Ø§Ù„Ø¯Ø¹Ù…</a>
          </div>
        </div>

        <div class="mini-card">
          <div class="top">
            <div>
              <div class="t">Ø¯ÙØ¹ Ù…ØªÙ†ÙˆØ¹</div>
              <div class="d">Ù…Ø¯Ù‰/Ø¨Ø·Ø§Ù‚Ø§Øª/Apple Pay Ù…Ø¹ Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©.</div>
            </div>
            <div class="ico">ğŸ’³</div>
          </div>
          <div class="foot">
            <span class="chip">Secure</span>
            <a class="link" href="#" data-action="policy">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª</a>
          </div>
        </div>
      </div>
    </section>

    <!-- âœ… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­Øª Ø§Ù„Ù‡ÙŠØ±Ùˆ Ù…Ø¨Ø§Ø´Ø±Ø© -->
    {% include "catalog_templates/products_section.html" with products=featured_products %}

    <!-- CATEGORIES (Tiles) -->
    <section class="section" id="categories">
      <div class="section-head">
        <div>
          <h2 class="section-title">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h2>
          <p class="section-sub">ØªØµÙ…ÙŠÙ… Ù…Ø®ØªÙ„Ù: Ø£Ù‚Ø³Ø§Ù… ÙƒØ¨Ø·Ø§Ù‚Ø§Øª ÙˆØ§Ø¶Ø­Ø© Ø¨Ø¯Ù„ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø§Øª</p>
        </div>
      </div>

      <div class="tiles">
        <a class="tile" href="#">
          <div class="row">
            <div class="name">Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª</div>
            <div class="ico">ğŸ’»</div>
          </div>
          <p class="hint">Ù„Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø© ÙˆØ§Ù„Ø¨Ø±Ù…Ø¬Ø© Ù…Ø¹ Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©.</p>
        </a>

        <a class="tile" href="#">
          <div class="row">
            <div class="name">Ø¬ÙˆØ§Ù„Ø§Øª</div>
            <div class="ico">ğŸ“±</div>
          </div>
          <p class="hint">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª ÙˆØ§Ù„Ù…Ù„Ø­Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.</p>
        </a>

        <a class="tile" href="#">
          <div class="row">
            <div class="name">Ø³Ù…Ø§Ø¹Ø§Øª</div>
            <div class="ico">ğŸ§</div>
          </div>
          <p class="hint">ØµÙˆØª Ù†Ù‚ÙŠ ÙˆØªØ¬Ø±Ø¨Ø© Ù…Ø±ÙŠØ­Ø© ÙÙŠ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ.</p>
        </a>

        <a class="tile" href="#">
          <div class="row">
            <div class="name">Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª</div>
            <div class="ico">ğŸ”Œ</div>
          </div>
          <p class="hint">ÙƒÙˆØ§Ø¨Ù„ØŒ Ø´ÙˆØ§Ø­Ù†ØŒ ÙˆÙ…Ù„Ø­Ù‚Ø§Øª Ù…ÙˆØ«ÙˆÙ‚Ø©.</p>
        </a>
      </div>
    </section>

    <!-- Benefits -->
    <section class="section">
      <div class="section-head">
        <div>
          <h2 class="section-title">Ù„Ù…Ø§Ø°Ø§ Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù†ÙŠØ©ØŸ</h2>
          <p class="section-sub">Ù†ÙØ³ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆÙ„ÙƒÙ† ÙÙŠ Ù‡ÙˆÙŠØ© Ù…Ø®ØªÙ„ÙØ© ØªÙ…Ø§Ù…Ù‹Ø§</p>
        </div>
      </div>

      <div class="benefits">
        <div class="benefit">
          <div class="t">Ù…Ù†ØªØ¬Ø§Øª Ø£ØµÙ„ÙŠØ©</div>
          <p class="d">Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ù…ÙˆØ«ÙˆÙ‚Ø© Ù…Ø¹ Ø¶Ù…Ø§Ù† ÙˆØ§Ø¶Ø­ ÙˆØªØ¬Ø±Ø¨Ø© Ø´Ø±Ø§Ø¡ Ù…Ø·Ù…Ø¦Ù†Ø©.</p>
        </div>
        <div class="benefit">
          <div class="t">Ø´Ø­Ù† Ø³Ø±ÙŠØ¹</div>
          <p class="d">ØªØ¬Ù‡ÙŠØ² Ø³Ø±ÙŠØ¹ ÙˆØªØªØ¨Ù‘Ø¹ ÙˆØ§Ø¶Ø­ Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©.</p>
        </div>
        <div class="benefit">
          <div class="t">Ø¯Ø¹Ù… ÙŠØ³Ø§Ø¹Ø¯Ùƒ</div>
          <p class="d">Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡.</p>
        </div>
      </div>
    </section>

  </main>

  {% include 'footer.html' %}

  <script>
    (function(){
      function toast(title, msg){
        if(window.appToast) window.appToast(title, msg);
        else alert((title ? title + "\n" : "") + (msg || ""));
      }

      // ===== CSRF (Django) =====
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
      }
      function csrfToken(){
        return getCookie('csrftoken');
      }

      // ===== ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø© ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± =====
      function updateHeaderCartCount(count){
        const el = document.getElementById('cartCountBadge');
        if(el) el.textContent = String(count);
        window.dispatchEvent(new CustomEvent('cart:updated', { detail: { count } }));
      }

      // ===== Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© Ø¹Ø¨Ø± Backend =====
      async function addToCart({ productId, variantId, quantity = 1 }){
        const url = "{% url 'orders:cart_add' %}";

        const form = new URLSearchParams();
        form.set('quantity', String(quantity));
        if(productId) form.set('product_id', String(productId));
        if(variantId) form.set('variant_id', String(variantId));

        const res = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8',
            'X-CSRFToken': csrfToken() || '',
            'X-Requested-With': 'XMLHttpRequest'
          },
          body: form.toString()
        });

        let data = null;
        try { data = await res.json(); } catch(_) {}

        if(!res.ok || !data || data.ok !== true){
          const msg = (data && data.error) ? data.error : 'ØªØ¹Ø°Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©.';
          throw new Error(msg);
        }
        return data; // { ok: true, cart_count: N }
      }

      // ===== Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© (Ù…Ù† include) =====
      document.querySelectorAll('[data-add-to-cart]').forEach(btn => {
        btn.addEventListener('click', async () => {
          const old = btn.textContent;

          const productId = btn.getAttribute('data-product-id');
          const variantId = btn.getAttribute('data-variant-id');

          const card = btn.closest('.card');
          const fallbackProductId = card ? card.getAttribute('data-product-id') : null;

          const finalProductId = productId || fallbackProductId;

          btn.disabled = true;
          btn.textContent = '... Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø¶Ø§ÙØ©';

          try{
            const data = await addToCart({
              productId: finalProductId,
              variantId: variantId,
              quantity: 1
            });

            updateHeaderCartCount(data.cart_count);

            btn.textContent = 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…';
            setTimeout(() => {
              btn.textContent = old.trim();
              btn.disabled = false;
            }, 850);

            toast('Ø§Ù„Ø³Ù„Ø©', 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø© âœ…');
          }catch(err){
            btn.textContent = old.trim();
            btn.disabled = false;
            toast('Ø®Ø·Ø£', err && err.message ? err.message : 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹');
          }
        });
      });

      // ===== Favorites (ÙƒÙ…Ø§ Ù‡Ùˆ) =====
      function getFavSet(){
        try{ return new Set(JSON.parse(localStorage.getItem('fav_set') || '[]')); }
        catch(_){ return new Set(); }
      }
      function saveFavSet(set){
        localStorage.setItem('fav_set', JSON.stringify(Array.from(set)));
      }
      function setFavCount(count){
        localStorage.setItem('fav_count', String(count));
        window.dispatchEvent(new Event('fav:updated'));
      }

      function refreshFavUI(){
        const favSet = getFavSet();
        document.querySelectorAll('[data-fav]').forEach(btn => {
          const card = btn.closest('.card');
          const domId = card?.getAttribute('data-dom-id'); // prod-<id>
          const isOn = domId && favSet.has(domId);
          btn.textContent = isOn ? 'â™¥ Ù…ÙØ¶Ù„Ø©' : 'â™¡ Ù…ÙØ¶Ù„Ø©';
        });
        setFavCount(favSet.size);
      }

      document.querySelectorAll('[data-fav]').forEach(btn => {
        btn.addEventListener('click', () => {
          const card = btn.closest('.card');
          const domId = card?.getAttribute('data-dom-id'); // prod-<id>
          const name = card?.getAttribute('data-product-name') || 'Ø§Ù„Ù…Ù†ØªØ¬';
          if(!domId) return;

          const favSet = getFavSet();
          let added = false;
          if(favSet.has(domId)){ favSet.delete(domId); }
          else{ favSet.add(domId); added = true; }

          saveFavSet(favSet);
          refreshFavUI();
          toast('Ø§Ù„Ù…ÙØ¶Ù„Ø©', added ? ('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ©: ' + name) : ('ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø©: ' + name));
        });
      });

      // âœ… Demo action: Ù„Ø§ ØªÙ…Ù†Ø¹ cart/login/signup
      document.querySelectorAll('[data-action]').forEach(el => {
        el.addEventListener('click', (e) => {
          const a = (el.getAttribute('data-action') || '').trim();
          if(a === 'cart' || a === 'login' || a === 'signup'){
            return;
          }
          e.preventDefault();
          if(a === 'track') return toast('ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ø·Ù„Ø¨', 'Ø§Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø¨ØµÙØ­Ø©/Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØªØ¨Ù‘Ø¹ Ù„Ø§Ø­Ù‚Ø§Ù‹.');
          if(a === 'support') return toast('Ø§Ù„Ø¯Ø¹Ù…', 'Ø§Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø¨ØµÙØ­Ø© Ø§Ù„Ø¯Ø¹Ù… Ø£Ùˆ ÙˆØ§ØªØ³Ø§Ø¨/ØªØ°ÙƒØ±Ø©.');
          if(a === 'policy') return toast('Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª', 'Ø§Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø¨ØµÙØ­Ø© Ø§Ù„Ø¶Ù…Ø§Ù† ÙˆØ§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„.');
          toast('ØªÙ†Ø¨ÙŠÙ‡', 'Ø²Ø± Ø¬Ø§Ù‡Ø² âœ… Ø§Ø±Ø¨Ø·Ù‡ Ø¨ØµÙØ­Ø© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.');
        });
      });

      refreshFavUI();
    })();
  </script>

</body>
</html>
